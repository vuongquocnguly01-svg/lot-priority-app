<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch Lot h√†ng c·∫ßn ∆∞u ti√™n nung</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- C·∫§U H√åNH G·ªêC --- */
        :root {
            --primary-color: #007bff; /* M√†u xanh d∆∞∆°ng ch√≠nh */
            --success-color: #28a745; /* M√†u xanh l√° cho n√∫t Th√™m */
            --danger-color: #dc3545; /* M√†u ƒë·ªè cho n√∫t X√≥a/ƒêƒÉng xu·∫•t */
            --text-color: #333;
            --bg-color: #f8f9fa; /* M√†u n·ªÅn nh·∫°t */
            --border-color: #dee2e6;
            --hover-bg: #e9ecef;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Cho n·ªôi dung ch√≠nh b·∫Øt ƒë·∫ßu t·ª´ tr√™n */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- CSS ƒêƒÇNG NH·∫¨P --- */
        #login-container {
            position: absolute; /* ƒê·∫£m b·∫£o n√≥ ·ªü gi·ªØa m√†n h√¨nh */
            top: 50%;
            transform: translateY(-50%);
            width: 350px;
            padding: 30px;
            background-color: white;
            box-shadow: var(--shadow-light);
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }
        #login-container h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
        }
        #login-container input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        #login-container input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        #login-container button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
            transition: background-color 0.2s, transform 0.1s;
        }
        #login-container button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        #error-message {
            color: var(--danger-color);
            margin-top: 10px;
            font-size: 0.9em;
        }

        /* --- CSS N·ªòI DUNG CH√çNH --- */
        #main-content {
            display: none;
            width: 95%;
            max-width: 1400px;
            margin-top: 0;
            padding: 30px;
            background-color: white;
            box-shadow: var(--shadow-light);
            border-radius: 10px;
            box-sizing: border-box;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        h1 {
            font-size: 28px;
            color: var(--primary-color);
            margin: 0;
        }

        #logout-button {
            padding: 8px 15px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #logout-button:hover {
            background-color: #c82333;
        }

        /* --- Thanh t√¨m ki·∫øm v√† n√∫t Th√™m Lot --- */
        .top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-container input {
            padding: 10px 15px;
            width: 350px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: border-color 0.2s;
        }
        .search-container input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .add-button {
            padding: 10px 20px;
            background-color: var(--success-color);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .add-button:hover {
            background-color: #1e7e34;
        }

        /* --- Form Th√™m Lot --- */
        .add-form {
            display: none;
            margin: 20px auto;
            width: 100%;
            padding: 20px;
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            box-sizing: border-box;
        }
        .add-form h3 {
            color: var(--text-color);
            margin-top: 0;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }
        .add-form textarea,
        .add-form select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        .add-form textarea {
            min-height: 120px;
            resize: vertical;
        }
        .add-form button {
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .add-form button:first-of-type { /* N√∫t Th√™m */
            background-color: var(--success-color);
            color: white;
            margin-right: 10px;
        }
        .add-form button:last-of-type { /* N√∫t H·ªßy */
            background-color: var(--danger-color);
            color: white;
        }

        /* --- B·∫£ng D·ªØ li·ªáu --- */
        table {
            width: 100%;
            border-collapse: separate; /* S·ª≠ d·ª•ng separate ƒë·ªÉ bo g√≥c */
            border-spacing: 0;
            margin-top: 15px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden; /* C·∫ßn thi·∫øt cho bo g√≥c */
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }
        th {
            background-color: var(--primary-color);
            color: white;
            text-transform: uppercase;
            font-weight: 700;
            border-bottom: none;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:nth-child(even) { /* M√†u n·ªÅn xen k·∫Ω */
            background-color: #f6f6f6;
        }
        tr:hover {
            background-color: var(--hover-bg);
        }

        /* --- √î ch·ªânh s·ª≠a tr·ª±c ti·∫øp --- */
        td[contenteditable="true"] {
            border: 1px solid transparent; /* M·∫∑c ƒë·ªãnh trong su·ªët */
            cursor: text;
        }
        td[contenteditable="true"]:hover {
            border: 1px dashed #aaa;
        }
        td[contenteditable="true"]:focus {
            border: 1px solid var(--primary-color);
            background-color: #e6f7ff; /* M√†u xanh nh·∫°t khi ƒëang s·ª≠a */
            outline: none;
        }

        /* --- Tr·∫°ng th√°i v√† Input --- */
        .status-select {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-weight: 700;
        }
        .status-pending { color: orange; border-color: orange; }
        .status-in-progress { color: var(--primary-color); border-color: var(--primary-color); }
        .status-completed { color: var(--success-color); border-color: var(--success-color); }

        .time-input {
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 150px;
        }
        .delete-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }

        /* --- Ph√¢n trang --- */
        .pagination {
            text-align: center;
            margin-top: 25px;
        }
        .pagination button {
            padding: 10px 18px;
            margin: 0 5px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .pagination button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .pagination button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            color: #666;
        }
        .pagination span {
            margin: 0 10px;
            font-weight: 700;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <div id="login-container">
        <h2>ƒêƒÉng nh·∫≠p H·ªá th·ªëng</h2>
        <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p">
        <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
        <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
        <p id="error-message"></p>
    </div>

    <div id="main-content">
        <header>
            <h1><span style="color: var(--success-color);">Danh s√°ch Lot</span> C·∫ßn ∆Øu Ti√™n</h1>
            <button id="logout-button" onclick="logout()">ƒêƒÉng xu·∫•t üö™</button>
        </header>

        <div class="top-controls">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm theo s·ªë Lot ho·∫∑c Keijo..." onkeyup="filterTable()">
            </div>
            <button class="add-button" onclick="toggleForm()">Th√™m Lot m·ªõi +</button>
        </div>

        <div class="add-form" id="addForm">
            <h3>Nh·∫≠p th√¥ng tin Lot m·ªõi</h3>
            <textarea id="newLotData" placeholder="D√°n danh s√°ch Lot, Keijo, ƒêi·ªán tr·ªü (M·ªói Lot 1 d√≤ng. V√≠ d·ª•: LOT001 Z10S-UW 100)" rows="10" required></textarea>

            <select id="newProcess" required>
                <option value="">Ch·ªçn c√¥ng ƒëo·∫°n</option>
                <option value="UC">UC</option>
                <option value="C">C</option>
                <option value="R">R</option>
                <option value="T1">T1</option>
                <option value="CLF">CLF</option>
                <option value="T2">T2</option>
                <option value="T3">T3</option>
                <option value="G1">G1</option>
                <option value="GH">GH</option>
            </select>
            <button onclick="addNewLot()">Th√™m</button>
            <button onclick="toggleForm()">H·ªßy</button>
        </div>

        <table id="lotTable">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>S·ªë Lot</th>
                    <th>Keijo</th>
                    <th>ƒêi·ªán tr·ªü (Œ©)</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Th·ªùi gian nung xong</th>
                    <th>C√¥ng ƒëo·∫°n</th>
                    <th>DELETE</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>

        <div class="pagination">
            <button id="prevBtn" onclick="changePage(-1)" disabled>‚óÄ Tr∆∞·ªõc</button>
            <span id="pageInfo">Trang 1 / 1</span>
            <button id="nextBtn" onclick="changePage(1)">Sau ‚ñ∂</button>
        </div>
    </div>

    <script>
        // --- C√ÅC BI·∫æN TO√ÄN C·ª§C ---
        let currentPage = 1;
        const rowsPerPage = 10;
        let allRows = [];
        let filteredRows = [];

        // C·∫•u h√¨nh ƒëƒÉng nh·∫≠p ƒë∆°n gi·∫£n (Ch·ªâ d√πng cho LocalStorage, KH√îNG B·∫¢O M·∫¨T)
        const VALID_USERNAME = 'admin';
        const VALID_PASSWORD = '05o82k1';
        const LOGIN_KEY = 'isLoggedIn';

        // --- C√ÅC H√ÄM X·ª¨ L√ù ƒêƒÇNG NH·∫¨P ---

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('error-message');

            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                localStorage.setItem(LOGIN_KEY, 'true');
                checkLoginStatus(); // T·∫£i n·ªôi dung ch√≠nh
            } else {
                errorMessage.textContent = 'T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.';
            }
        }

        function logout() {
            localStorage.removeItem(LOGIN_KEY);
            checkLoginStatus(); // Quay l·∫°i trang ƒëƒÉng nh·∫≠p
        }

        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem(LOGIN_KEY) === 'true';
            const loginContainer = document.getElementById('login-container');
            const mainContent = document.getElementById('main-content');

            if (isLoggedIn) {
                loginContainer.style.display = 'none';
                mainContent.style.display = 'block';
                // T·∫£i d·ªØ li·ªáu v√† kh·ªüi t·∫°o b·∫£ng khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
                loadLotsFromLocalStorage();
                updateRowNumbers();
                updatePagination();
            } else {
                loginContainer.style.display = 'block';
                mainContent.style.display = 'none';
                document.getElementById('error-message').textContent = '';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // --- C√ÅC H√ÄM X·ª¨ L√ù S·∫ÆP X·∫æP V√Ä LOCALSTORAGE ---

        function saveLotsToLocalStorage() {
            const tableBody = document.getElementById('tableBody');
            const rows = Array.from(tableBody.querySelectorAll('tr'));
            const lotsData = [];

            rows.forEach(row => {
                const timeInput = row.cells[5].querySelector('.time-input');

                lotsData.push({
                    lot: row.cells[1].textContent,
                    keijo: row.cells[2].textContent,
                    resistance: row.cells[3].textContent,
                    status: row.cells[4].querySelector('.status-select').value,
                    time: timeInput ? timeInput.value : '',
                    process: row.cells[6].textContent
                });
            });
            localStorage.setItem('lotList', JSON.stringify(lotsData));
        }

        function sortAndSaveLots() {
            const tableBody = document.getElementById('tableBody');
            let rows = Array.from(tableBody.querySelectorAll('tr'));

            const activeRows = rows.filter(row => row.cells[4].querySelector('.status-select').value !== 'Ho√†n th√†nh');
            const completedRows = rows.filter(row => row.cells[4].querySelector('.status-select').value === 'Ho√†n th√†nh');

            tableBody.innerHTML = '';
            [...activeRows, ...completedRows].forEach(row => {
                tableBody.appendChild(row);
            });

            saveLotsToLocalStorage();
            updateRowNumbers();
            updatePagination();
        }

        function loadLotsFromLocalStorage() {
            const savedData = localStorage.getItem('lotList');
            if (savedData) {
                const lots = JSON.parse(savedData);

                const activeLots = lots.filter(data => data.status !== 'Ho√†n th√†nh');
                const completedLots = lots.filter(data => data.status === 'Ho√†n th√†nh');
                const sortedLots = [...activeLots, ...completedLots];

                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';

                const defaultStatusClass = {
                    'Ch·ªù x·ª≠ l√Ω': 'status-pending',
                    'ƒêang nung': 'status-in-progress',
                    'Ho√†n th√†nh': 'status-completed'
                };

                sortedLots.forEach(data => {
                    const newRow = document.createElement('tr');
                    tableBody.appendChild(newRow);

                    const statusClass = defaultStatusClass[data.status] || 'status-pending';

                    newRow.innerHTML = `
                        <td></td>
                        <td contenteditable="true" data-type="lot">${data.lot}</td>
                        <td contenteditable="true" data-type="keijo">${data.keijo}</td>
                        <td contenteditable="true" data-type="resistance">${data.resistance}</td>
                        <td>
                            <select class="status-select ${statusClass}" onchange="changeStatus(this)">
                                <option value="Ch·ªù x·ª≠ l√Ω" ${data.status === 'Ch·ªù x·ª≠ l√Ω' ? 'selected' : ''}>Ch·ªù x·ª≠ l√Ω</option>
                                <option value="ƒêang nung" ${data.status === 'ƒêang nung' ? 'selected' : ''}>ƒêang nung</option>
                                <option value="Ho√†n th√†nh" ${data.status === 'Ho√†n th√†nh' ? 'selected' : ''}>Ho√†n th√†nh</option>
                            </select>
                        </td>
                        <td><input type="datetime-local" class="time-input" value="${data.time}" onchange="sortAndSaveLots()"></td>
                        <td contenteditable="true" data-type="process">${data.process}</td>
                        <td><button class="delete-btn" onclick="deleteLot(this)">X√≥a</button></td>
                    `;

                    const editableCells = newRow.querySelectorAll('td[contenteditable="true"]');
                    editableCells.forEach(cell => {
                        cell.addEventListener('blur', () => {
                            sortAndSaveLots();
                            if (cell.dataset.type === 'lot') {
                                filterTable(false);
                            }
                        });
                    });
                });
            }
        }

        // --- H√ÄM T√çNH TO√ÅN TH·ªúI GIAN K·∫æT TH√öC NUNG ---
        function calculateFinishTime() {
            // L·∫•y th·ªùi ƒëi·ªÉm hi·ªán t·∫°i
            const now = new Date();

            // C·ªông th√™m 1 gi·ªù (60 ph√∫t) v√† 40 ph√∫t
            // T·ªïng c·ªông 100 ph√∫t
            now.setMinutes(now.getMinutes() + 100);

            // H√†m ƒë·ªám s·ªë 0 (v√≠ d·ª•: 9 -> '09')
            const pad = (num) => (num < 10 ? '0' : '') + num;

            // ƒê·ªãnh d·∫°ng th√†nh chu·ªói 'YYYY-MM-DDThh:mm' cho input type="datetime-local"
            const year = now.getFullYear();
            const month = pad(now.getMonth() + 1); // Th√°ng b·∫Øt ƒë·∫ßu t·ª´ 0
            const day = pad(now.getDate());
            const hour = pad(now.getHours());
            const minute = pad(now.getMinutes());

            return `${year}-${month}-${day}T${hour}:${minute}`;
        }


        // --- C√ÅC H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN V√Ä PH√ÇN TRANG KH√ÅC ---

        function updateRowNumbers() {
            const allRowsInTable = document.querySelectorAll('#tableBody tr');
            allRowsInTable.forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
            allRows = Array.from(document.querySelectorAll('#tableBody tr'));
            filterTable(false);
        }

        function changeStatus(selectElement) {
            const newStatus = selectElement.value;
            updateStatusClass(selectElement, newStatus);

            const row = selectElement.closest('tr');
            const timeInput = row.cells[5].querySelector('.time-input');

            // Logic T·ª∞ ƒê·ªòNG C·∫¨P NH·∫¨T TH·ªúI GIAN NUNG
            if (newStatus === 'ƒêang nung' && !timeInput.value) {
                // Ch·ªâ c·∫≠p nh·∫≠t n·∫øu tr·∫°ng th√°i l√† "ƒêang nung" v√† √¥ th·ªùi gian ƒëang tr·ªëng
                timeInput.value = calculateFinishTime();
            } else if (newStatus !== 'ƒêang nung') {
                // N·∫øu mu·ªën x√≥a khi chuy·ªÉn tr·∫°ng th√°i kh√°c "Ho√†n th√†nh", uncomment d√≤ng d∆∞·ªõi:
                // timeInput.value = '';
            }

            sortAndSaveLots();
        }

        function updateStatusClass(selectElement, status) {
            selectElement.className = 'status-select';
            if (status === 'Ch·ªù x·ª≠ l√Ω') {
                selectElement.classList.add('status-pending');
            } else if (status === 'ƒêang nung') {
                selectElement.classList.add('status-in-progress');
            } else if (status === 'Ho√†n th√†nh') {
                selectElement.classList.add('status-completed');
            }
        }

        function filterTable(resetPage = true) {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const rows = allRows;
            filteredRows = [];

            rows.forEach(row => {
                const lotCell = row.cells[1].textContent.toLowerCase();
                const keijoCell = row.cells[2].textContent.toLowerCase();

                // M·ªü r·ªông t√¨m ki·∫øm sang c·∫£ c·ªôt Keijo
                if (lotCell.includes(searchValue) || keijoCell.includes(searchValue)) {
                    filteredRows.push(row);
                }
            });

            if (resetPage) {
                currentPage = 1;
            }
            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;

            allRows.forEach(row => row.style.display = 'none');
            filteredRows.slice(start, end).forEach(row => row.style.display = '');

            document.getElementById('pageInfo').textContent = `Trang ${currentPage} / ${totalPages > 0 ? totalPages : 1}`;
            document.getElementById('prevBtn').disabled = currentPage === 1 || totalPages <= 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages <= 1;
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
            currentPage += direction;
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            updatePagination();
        }

        function toggleForm() {
            const form = document.getElementById('addForm');
            form.style.display = form.style.display === 'none' || form.style.display === '' ? 'block' : 'none';
            if (form.style.display === 'block') {
                document.getElementById('newLotData').value = '';
                document.getElementById('newProcess').value = '';
            }
        }

        function addNewLot() {
            const lotData = document.getElementById('newLotData').value;
            const newProcess = document.getElementById('newProcess').value;

            if (!lotData || !newProcess) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·ªß d·ªØ li·ªáu Lot (Lot, Keijo, ƒêi·ªán tr·ªü) v√† ch·ªçn C√¥ng ƒëo·∫°n!');
                return;
            }

            const lines = lotData.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const processedLots = [];

            lines.forEach(line => {
                const columns = line.split(/\s+/).filter(col => col.length > 0);

                if (columns.length >= 3) {
                    // *** ƒê√É TH√äM .toUpperCase() V√ÄO ƒê√ÇY ***
                    const lot = columns[0].toUpperCase();
                    const keijo = columns[1];
                    const resistance = columns[2];
                    processedLots.push({ lot, keijo, resistance });
                }
            });

            if (processedLots.length === 0) {
                alert('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu Lot h·ª£p l·ªá (Lot, Keijo, ƒêi·ªán tr·ªü). Vui l√≤ng ki·ªÉm tra l·∫°i ƒë·ªãnh d·∫°ng!');
                return;
            }

            const tableBody = document.getElementById('tableBody');
            const defaultStatusClass = 'status-pending';

            processedLots.forEach(({ lot, keijo, resistance }) => {
                const newRow = document.createElement('tr');

                if (tableBody.firstChild) {
                    tableBody.insertBefore(newRow, tableBody.firstChild);
                } else {
                    tableBody.appendChild(newRow);
                }

                newRow.innerHTML = `
                    <td></td>
                    <td contenteditable="true" data-type="lot">${lot}</td>
                    <td contenteditable="true" data-type="keijo">${keijo}</td>
                    <td contenteditable="true" data-type="resistance">${resistance}</td>
                    <td>
                        <select class="status-select ${defaultStatusClass}" onchange="changeStatus(this)">
                            <option value="Ch·ªù x·ª≠ l√Ω" selected>Ch·ªù x·ª≠ l√Ω</option>
                            <option value="ƒêang nung">ƒêang nung</option>
                            <option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
                        </select>
                    </td>
                    <td><input type="datetime-local" class="time-input" value="" onchange="sortAndSaveLots()"></td>
                    <td contenteditable="true" data-type="process">${newProcess}</td>
                    <td><button class="delete-btn" onclick="deleteLot(this)">X√≥a</button></td>
                `;

                const editableCells = newRow.querySelectorAll('td[contenteditable="true"]');
                editableCells.forEach(cell => {
                    cell.addEventListener('blur', () => {
                        sortAndSaveLots();
                        if (cell.dataset.type === 'lot') {
                            filterTable(false);
                        }
                    });
                });
            });

            toggleForm();
            sortAndSaveLots();
            alert(`Th√™m th√†nh c√¥ng ${processedLots.length} Lot m·ªõi!`);
        }

        function deleteLot(button) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a Lot n√†y kh√¥ng?')) return;

            const row = button.closest('tr');
            row.remove();

            sortAndSaveLots();

            const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            }
            if (filteredRows.length === 0) {
                currentPage = 1;
            }
            updatePagination();
        }

        // H√ÄM KH·ªûI T·∫†O
        document.addEventListener('DOMContentLoaded', () => {
            // Ch·ªâ ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p, n·∫øu th√†nh c√¥ng m·ªõi t·∫£i d·ªØ li·ªáu
            checkLoginStatus();

            // X·ª≠ l√Ω s·ª± ki·ªán Enter trong form ƒëƒÉng nh·∫≠p
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>